<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>API Tool</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    .unvisible {
      display: none;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
</head>
<body>
  <!-- App -->
  <div id="app" class="container">

    <!--Control Panel-->
    <div class="my-4">

      <div class="form-inline">
        <label for="search">搜尋幣別：</label>
        <input type="text" class="form-control" v-model="filteValue" @keyup="filter" />
      </div>

      <div class="form-inline mt-3">
        <label for="search">兌換試算：</label>
        <select class="form-control mr-3" v-model="cashType">
          <option value="cash">現金交易</option>
          <option value="recent">網路交易</option>
        </select>
        <select class="form-control" v-model.number="exchange.rate.from">
          <option value="1">台幣（NTD）</option>
          <option v-for="item in rateInfo.data" 
            :value="item[cashType].buy" 
            :disabled="item[cashType].buy === '-'"
          >{{ item.title }}</option>
        </select>
        <input type="text" class="form-control" v-model.number="exchange.quality">
        -->
        <select class="form-control" v-model="exchange.rate.to">
          <option value="1">台幣（NTD）</option>
          <option v-for="item in rateInfo.data" 
            :value="item[cashType].sale"
            :disabled="item[cashType].sale === '-'"
          >{{ item.title }}</option>
        </select>
        <input type="text" class="form-control" v-model="exchangeResult">
      </div>

    </div>
    <!--Control Panel End-->

    <!--Loading-->
    <div v-if="loading">Now Loading...</div>
    <!--Loading End-->

    <!--Rate Table-->
    <div id="rate-table" v-if="!loading">
      <table class="table table-sm table-striped table-hover">
        <tr class="table-primary">
          <th>幣別</th><th>本行現金買入</th><th>本行現金賣出</th><th>本行即期買入</th><th>本行即期賣出</th>
        </tr>
        <tr class="dollar-row" v-for="item in rateInfo.data" :key="item.title">
          <td class="dollar-title">{{ item.title }}</td>
          <td>{{ item.cash.buy }}</td>
          <td>{{ item.cash.sale }}</td>
          <td>{{ item.recent.buy }}</td>
          <td>{{ item.recent.sale }}</td>
        </tr>
      </table>
    </div>
    <!--Rate Table End-->

  </div>
  <!-- App End -->

  <script>
    new Vue({
      el: '#app',
      data: {
        loading: true,
        filteValue: '',
        cashType: 'cash',
        exchange: {
          rate: {
            from: 1,
            to: 1
          },
          quality: 0
        },
        rateInfo: {}
      },
      computed: {
        exchangeResult() {
          const ex = this.exchange
          return ((ex.rate.from * ex.quality) / ex.rate.to).toFixed(2)
        }
      },
      methods: {
        search() {
          fetch('/api/rate')
            .then(res => res.json())
            .then(res => {
              this.rateInfo = res
              this.loading = false
            });
        },
        filter(){
          const vm = this

          let rows = document.getElementsByClassName('dollar-row');
          let titles = document.getElementsByClassName('dollar-title');
          for (let i=0;i<rows.length;i++){
            if (titles[i].innerHTML.indexOf(vm.filteValue) === -1){
              rows[i].classList.add('unvisible');
            } else {
              rows[i].classList.remove('unvisible');
            }
          }
        }
      },
      mounted() {
        this.search()
      }
    })
  </script>
</body>
</html>